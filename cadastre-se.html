<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Adoteaí - Cadastro de Usuário</title>
</head>

<body>
    <header>
        <nav class="navbar">
          <div class="logo-container"> <img
              src="https://i.postimg.cc/BvbcYbWy/Chat-GPT-Image-16-de-out-de-2025-10-56-29-removebg-preview-1.png"
              class="logo"></div>
          <ul class="nav-links"> <a href="index.html#home">Inicio</a>
            <li><a href="index.html#sobre">Sobre</a></li>
            <li><a href="index.html#pets">Pets</a></li>
            <li><a href="index.html#localização">Localização</a></li>
          </ul>
        </nav>
    </header>

    <style>
        body {
          font-family: Arial, sans-serif;
          background: #f4f4f4;
          margin: 0;
          padding: 0;
          display: flex;
          padding-top: 60px; 
        }

        .container {
          background: #fff;
          padding: 20px;
          border-radius: 20px;
          box-shadow: 0 0 10px rgba(0, 0, 0, .1);
          width: 400px;
          margin: 70px auto; 
        }

        input,
        button {
          width: 100%;
          padding: 10px;
          margin: 8px 0;
          border-radius: 5px;
          border: 1px solid #ccc;
          font-size: 14px
        }

        button {
          background: #eca487;
          color: #fff;
          border: none;
          cursor: pointer
        }

        button:hover {
          opacity: .9
        }
    </style>

    <div class="container">
      <h2>Cadastro de Usuário</h2>
      <form id="cadastro-form" autocomplete="off"> 
        <input type="text" name="nome" id="nome" placeholder="Nome completo" required /> 
        <input type="email" name="email" id="email" placeholder="E-mail" required /> 
        <input type="password" name="senha" id="senha" placeholder="Senha" required /> 
        <input type="tel" name="telefone" id="telefone" placeholder="Telefone" /> 
        <input type="file" name="foto" id="foto" accept="image/*" /> 
        <input type="text" name="endereco" id="endereco" placeholder="Endereço completo" required /> 
        <input type="date" name="nascimento" id="nascimento" placeholder="Data de nascimento" /> 
        <input type="number" name="idade" id="idade" placeholder="Idade" min="0" />       
          
        <button type="submit">Cadastrar</button>
        <p style="text-align:center;font-size:14px;margin-top:10px;">Já tem cadastro? <a href="login.html">Entrar</a>
        </p>
      </form>
    </div>

    <script type="module">
        // Importa as funções necessárias, incluindo o Authentication
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        
        // ⚠️ CONFIGURAÇÃO DO FIREBASE (USE SEUS DADOS REAIS AQUI)
        const firebaseConfig = {
            apiKey: "AIzaSyDc8aaQ2LoBe10kIqxSaCTEwj-FgLbJHJM",
            authDomain: "adoteai.firebaseapp.com",
            projectId: "adoteai",
            storageBucket: "adoteai.firebasestorage.app",
            messagingSenderId: "936118376881",
            appId: "1:936118376881:web:704edb4cb3b861fa58c590",
            measurementId: "G-5SWYF0Y1JK"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); 
        const auth = getAuth(app); 
        
        // A função não precisa mais do 'window.' se for chamada via EventListener
        async function salvarUsuario() {
            // Recupera os valores dos campos
            const nome = document.getElementById('nome').value.trim();
            const email = document.getElementById('email').value.trim();
            const senha = document.getElementById('senha').value; 
            
            // Validações obrigatórias
            if (!nome || !email || !senha) {
                alert("Por favor, preencha os campos Nome, E-mail e Senha.");
                return;
            }
            if (senha.length < 6) {
                alert("A senha deve ter pelo menos 6 caracteres.");
                return;
            }

            // Tenta CRIAR o usuário com E-mail e Senha
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
                const user = userCredential.user;

                // Salva os DADOS ADICIONAIS no Firestore (sem a senha)
                const dadosUsuario = {
                    uid: user.uid,
                    nome: nome,
                    email: email,
                    telefone: document.getElementById('telefone').value,
                    endereco: document.getElementById('endereco').value,
                    nascimento: document.getElementById('nascimento').value,
                    idade: document.getElementById('idade').value,
                    dataCadastro: serverTimestamp()
                };

                // Adiciona na coleção "usuarios"
                await addDoc(collection(db, "usuarios"), dadosUsuario);
                
                alert(`Bem-vindo(a), ${nome}! Seu cadastro foi concluído com sucesso.`);
                document.getElementById('cadastro-form').reset();
                
                // Redireciona para a página de boas-vindas
                const nomeCodificado = encodeURIComponent(nome); 
                window.location.href = "pagina-usuario.html?nome=" + nomeCodificado;

            } catch (error) {
                console.error("Erro no Cadastro:", error.code, error.message);
                
                let mensagemErro = "Ocorreu um erro no cadastro. Tente novamente.";
                if (error.code === 'auth/email-already-in-use') {
                    mensagemErro = "Este e-mail já está em uso.";
                } else if (error.code === 'auth/weak-password') {
                    mensagemErro = "A senha deve ser mais forte (mínimo 6 caracteres).";
                } else if (error.code === 'auth/invalid-email') {
                    mensagemErro = "O e-mail fornecido não é válido.";
                } else if (error.code === 'auth/network-request-failed') {
                    mensagemErro = "Falha na conexão de rede. Verifique sua internet.";
                }
                alert(mensagemErro);
            }
        }

        // CORREÇÃO 2: Adiciona um Event Listener ao formulário para garantir a chamada da função
        document.getElementById('cadastro-form').addEventListener('submit', function(event) {
            event.preventDefault(); // IMPEDE QUE A PÁGINA RECARREGUE
            salvarUsuario(); // Chama a função
        });
    </script>
</body>
</html>