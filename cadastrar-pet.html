<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css"> 
    <title>AdoteAí — Cadastre um Pet</title>
    
    <style>
        body {
            /* Fundo padrão do cadastro de usuário */
            background: #f4f4f4; 
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
            /* Garante que o conteúdo não fique sob o header fixo */
            padding-top: 80px; 
        }

        /* Centraliza o formulário no meio da tela */
        main {
            display: flex;
            justify-content: center;
            align-items: center; 
            /* Altura mínima para permitir a centralização vertical */
            min-height: calc(100vh - 80px); 
            padding: 20px 0;
        }
        
        /* Estilo do Container (Mantendo o padrão compacto de 350px, se definido no style.css) */
        .cadastre-pet .container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, .1);
            width: 350px; 
            max-width: 90%; 
            margin-top: 0; /* Removido o conflito com margin-top de 50px */
            text-align: center;
        }

        /* O estilo dos inputs, labels e botões deve estar no style.css para manter a consistência. */
    </style>
</head>
<body>

<header>
    <nav class="navbar">
        <div class="logo-container">
            <img src="https://i.postimg.cc/BvbcYbWy/Chat-GPT-Image-16-de-out-de-2025-10-56-29-removebg-preview-1.png" class="logo">
        </div>
     
        <ul class="nav-links"> 
            <li><a href="index.html#home">Inicio</a></li>
            <li><a href="index.html#sobre">Sobre</a></li>
            <li><a href="index.html#pets">Pets</a></li>
            <li><a href="index.html#localização">Localização</a></li>
        </ul>
    </nav>
</header>
<main>
    <section class="cadastre-pet">
        <div class="container">
            <h2>Cadastre um Pet</h2>
            
            <form id="pet-form" class="cadastro-form">
                <label for="nome">Nome do Pet:</label>
                <input type="text" id="nome" name="nome" placeholder="Digite o nome do pet" required>

                <label for="tipo">Tipo de Pet:</label>
                <select id="tipo" name="tipo" required>
                    <option value="">Selecione</option>
                    <option value="Cachorro">Cachorro</option>
                    <option value="Gato">Gato</option>
                    <option value="Outros">Outros</option>
                </select>

                <label for="descricao">Descrição:</label>
                <textarea id="descricao" name="descricao" placeholder="Digite uma breve descrição" required></textarea>

                <label for="foto">Foto do Pet:</label>
                <input type="file" id="foto" name="foto" accept="image/*" required>

                <button type="submit" class="btn">CADASTRE UM PET</button>
            </form>

            <p id="status-mensagem" style="margin-top: 15px; font-weight: bold;"></p>
        </div>
    </section>
</main>

<footer>
    <p>2025 AdoteAí - Todos os direitos reservados</p>
</footer>

<script type="module">
    // IMPORTAÇÕES ATUALIZADAS: Adicionado Firebase Storage
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    // Sua configuração do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDc8aaQ2LoBe10kIqxSaCTEwj-FgLbJHJM",
        authDomain: "adoteai.firebaseapp.com",
        projectId: "adoteai",
        storageBucket: "adoteai.firebasestorage.app", // ESSENCIAL para o Storage
        messagingSenderId: "936118376881",
        appId: "1:936118376881:web:704edb4cb3b861fa58c590",
        measurementId: "G-5SWYF0Y1JK"
    };

    // Inicializa o Firebase, Firestore e Storage
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); 
    const storage = getStorage(app); // Inicializa o Storage

    // Referência aos elementos
    const form = document.getElementById('pet-form');
    const statusMensagem = document.getElementById('status-mensagem');

    async function salvarPet(event) {
        event.preventDefault(); // Impede o envio padrão do formulário
        
        statusMensagem.textContent = "Validando dados...";

        // 1. Recupera os valores dos campos
        const nome = document.getElementById('nome').value.trim();
        const tipo = document.getElementById('tipo').value;
        const descricao = document.getElementById('descricao').value.trim();
        const fotoInput = document.getElementById('foto');
        const fotoFile = fotoInput.files[0];
        
        if (!nome || !tipo || !descricao || !fotoFile) {
            statusMensagem.textContent = "Por favor, preencha todos os campos e selecione uma foto.";
            return;
        }

        try {
            // --- ETAPA 1: UPLOAD DA IMAGEM PARA O FIREBASE STORAGE ---
            statusMensagem.textContent = "Fazendo upload da foto... Por favor, aguarde.";
            
            // Cria um caminho único no Storage (ex: pets/1678880000000-foto.jpg)
            const fileName = `pets/${Date.now()}-${fotoFile.name}`;
            const storageRef = ref(storage, fileName);

            // Faz o upload do arquivo
            const uploadResult = await uploadBytes(storageRef, fotoFile);

            // Pega a URL pública que o carrossel precisa
            const fotoUrl = await getDownloadURL(uploadResult.ref);
            
            // --- ETAPA 2: SALVAR DADOS E URL NO FIRESTORE ---
            statusMensagem.textContent = "Salvando informações do pet no banco de dados...";

            // 2. Cria o objeto Pet com a URL COMPLETA
            const novoPet = {
                nome: nome,
                tipo: tipo,
                descricao: descricao,
                fotoUrl: fotoUrl, // <--- CAMPO CORRIGIDO COM A URL COMPLETA
                dataCadastro: serverTimestamp(),
                disponivel: true 
            };

            // 3. Salva no banco de dados "pets" do Firebase
            await addDoc(collection(db, "pets"), novoPet);

            // --- ETAPA 3: FINALIZAÇÃO ---
            statusMensagem.textContent = `✅ Pet "${nome}" cadastrado com sucesso! Redirecionando...`;
            form.reset(); // Limpa o formulário
            
            // Redireciona para o carrossel após 2 segundos
            setTimeout(() => {
                 // Redireciona para o index.html e rola até a seção #pets
                 window.location.href = 'index.html#pets'; 
            }, 2000); 

        } catch (error) {
            console.error("Erro no cadastro:", error);
            statusMensagem.textContent = `❌ Erro ao cadastrar o pet: ${error.message}. Verifique as Regras do Storage!`;
        }
    }

    // Adiciona o listener ao evento de submit do formulário
    form.addEventListener('submit', salvarPet);
</script>

</body>
</html>